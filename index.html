<script>
  const edges = [
    [[1, 4], [2, 5], [3, 6]],
    [[4, 7], [5, 2]],
    [[4, 3], [5, 1]],
    [[4, 6], [6, 20]],
    [[5, 9], [7, 5]],
    [[6, 8], [7, 5], [8, 5]],
    [[9, 10]],
    [[8, 5], [9, 1]],
    [[9, 5]],
    []
  ];

  const positions = {
    0: [50, 150], 1: [150, 50], 2: [150, 150],
    3: [150, 250], 4: [300, 250], 5: [300, 50],
    6: [350, 150], 7: [450, 200], 8: [500, 100],
    9: [600, 150]
  };

  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");

  function dijkstra(edges, numNodes) {
    const node = Array(numNodes).fill(Infinity);
    node[0] = 0;
    const parent = Array(numNodes).fill(-1);
    const nodeName = [...Array(numNodes).keys()];

    while (nodeName.length > 0) {
      const r = nodeName.reduce((a, b) => node[a] < node[b] ? a : b);
      nodeName.splice(nodeName.indexOf(r), 1);

      for (const [goal, people] of edges[r]) {
        const weight = people > 0 ? 1 / people : Infinity;
        if (node[r] + weight < node[goal]) {
          node[goal] = node[r] + weight;
          parent[goal] = r;
        }
      }
    }

    return { node, parent };
  }

  function reconstructPath(parent, dest) {
    const path = [];
    let current = dest;
    while (current !== -1) {
      path.unshift(current);
      current = parent[current];
    }
    return path;
  }

  function drawGraph() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // ノード描画
    for (let i = 0; i < 10; i++) {
      const [x, y] = positions[i];
      ctx.beginPath();
      ctx.arc(x, y, 10, 0, 2 * Math.PI);
      ctx.fillStyle = "#555";
      ctx.fill();
      ctx.fillStyle = "#000";
      ctx.font = "16px sans-serif";
      ctx.fillText(String.fromCharCode(65 + i), x - 5, y - 15);
    }

    // エッジ描画
    ctx.strokeStyle = "#aaa";
    ctx.lineWidth = 1;
    for (let from = 0; from < edges.length; from++) {
      const [x1, y1] = positions[from];
      for (const [to, _] of edges[from]) {
        const [x2, y2] = positions[to];
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
      }
    }
  }

  function drawPath(path) {
    drawGraph();  // 背景再描画
    ctx.strokeStyle = "red";
    ctx.lineWidth = 4;
    ctx.beginPath();
    for (let i = 0; i < path.length - 1; i++) {
      const [x1, y1] = positions[path[i]];
      const [x2, y2] = positions[path[i + 1]];
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
    }
    ctx.stroke();
  }

  function findCost() {
    const destChar = document.getElementById("destination").value.toUpperCase();
    const destIndex = destChar.charCodeAt(0) - "A".charCodeAt(0);
    if (destIndex < 0 || destIndex > 9) {
      alert("A〜Jの範囲で駅名を入力してください。");
      return;
    }
    const { node, parent } = dijkstra(edges, 10);
    const path = reconstructPath(parent, destIndex);
    drawPath(path);
    alert(`${destChar}駅までの最適経路:\n` + path.map(i => String.fromCharCode(65 + i) + "駅").join(" → "));
  }

  setInterval(() => {
    const now = new Date();
    document.getElementById("clock").textContent = now.toLocaleTimeString();
  }, 1000);

  // 初期描画
  drawGraph();
</script>

